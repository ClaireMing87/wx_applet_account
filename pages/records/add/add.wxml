<view class="container">
  <!-- è¿”å›æŒ‰é’® -->
  <view class="header">
    <view class="back-button" bindtap="onBack">
      <text class="back-icon">â†</text>
      <text class="back-text">è¿”å›</text>
    </view>
    <text class="page-title">{{editingId ? 'ç¼–è¾‘è®°å½•' : 'è®°ä¸€ç¬”'}}</text>
  </view>
  
  <!-- æ”¶æ”¯é€‰æ‹© -->
  <view class="card">
    <view class="type-selector">
      <view class="type-item {{recordType === 'expense' ? 'active' : ''}}" bindtap="selectType" data-type="expense">
        <text class="type-icon">ğŸ’¸</text>
        <text class="type-text">æ”¯å‡º</text>
      </view>
      <view class="type-item {{recordType === 'income' ? 'active' : ''}}" bindtap="selectType" data-type="income">
        <text class="type-icon">ğŸ’°</text>
        <text class="type-text">æ”¶å…¥</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»é€‰æ‹© -->
  <view class="card">
    <text class="section-title">é€‰æ‹©åˆ†ç±»</text>
    <view class="categories-grid">
      <view class="category-item {{selectedCategory.id === item.id ? 'selected' : ''}}" 
            wx:for="{{categories}}" 
            wx:key="id" 
            bindtap="selectCategory" 
            data-category="{{item}}">
        <text class="category-icon">{{selectedCategory.id === item.id && selectedCategory.subIcon ? selectedCategory.subIcon : item.icon}}</text>
        <text class="category-name">{{selectedCategory.id === item.id && selectedCategory.subName ? (selectedCategory.name + '-' + selectedCategory.subName) : item.name}}</text>
      </view>
    </view>
  </view>

  <!-- è´¦æˆ·é€‰æ‹© -->
  <view class="card">
    <view class="account-selector">
      <view class="account-item" 
            bindtap="selectAccount" 
            data-account="account">
        <text class="account-icon">{{selectedAccountIcon || 'ğŸ’³'}}</text>
        <text class="account-text">{{selectedAccountName || 'è´¦æˆ·'}}</text>
      </view>
      <view class="account-item" 
            bindtap="selectAccount" 
            data-account="budget">
        <text class="account-icon">ğŸ¦</text>
        <text class="account-text">{{budgetScope === 'month' ? 'è®¡å…¥å½“æœˆé¢„ç®—' : budgetScope === 'year' ? 'åªè®¡å…¥å¹´é¢„ç®—' : 'ä¸è®¡å…¥é¢„ç®—'}}</text>
      </view>
      <view class="account-item" 
            bindtap="selectAccount" 
            data-account="tag">
        <text class="account-icon">ğŸ·</text>
        <text class="account-text">{{selectedTag ? selectedTag.name : 'æ ‡ç­¾'}}</text>
      </view>
      <view class="account-item" 
            bindtap="selectAccount" 
            data-account="template">
        <text class="account-icon">ğŸ“’</text>
        <text class="account-text">{{selectedTemplate ? selectedTemplate.name : 'æ¨¡æ¿'}}</text>
      </view>
    </view>
  </view>

  <!-- é‡‘é¢ã€å¤‡æ³¨å’Œæ—¥æœŸ -->
  <view class="card">
    <view class="amount-note-date-row">
      <view class="note-section">
        <input class="note-input" type="text" value="{{note}}" bindinput="onNoteInput" placeholder="æ·»åŠ å¤‡æ³¨..." />
      </view>
          <view class="date-section">
            <picker mode="multiSelector" range="{{dateTimeRange}}" value="{{dateTimeValue}}" bindchange="onDateTimeChange">
              <view class="date-picker">
                <text class="date-icon">ğŸ“…</text>
                <text class="date-text">{{displayDate}} {{String(dateTimeValue[3]).padStart(2, '0')}}:{{String(dateTimeValue[4]).padStart(2, '0')}}</text>
                <text class="date-arrow">></text>
              </view>
            </picker>
          </view>
      <view class="amount-section">
        <view class="amount-display">
          <text class="currency">Â¥</text>
          <text class="amount-text">{{amount || '0.00'}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¹å®«æ ¼æ•°å­—é”®ç›˜ -->
  <view class="keyboard-section">
    <view class="number-keyboard">
      <view class="keyboard-row" wx:for="{{keyboardRows}}" wx:key="index">
        <view class="keyboard-key {{key === 'ä¿å­˜' ? 'save-key' : ''}}" 
              wx:for="{{item}}" 
              wx:for-item="key" 
              wx:key="key"
              bindtap="onKeyPress" 
              data-key="{{key}}">
          <text class="key-text {{key === 'âŒ«' ? 'backspace' : ''}}">{{key}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- äºŒçº§èœå•å¼¹çª— -->
  <view class="sub-menu-overlay" wx:if="{{showSubMenu}}" bindtap="closeSubMenu">
    <view class="sub-menu-popup" catchtap="">
      <view class="sub-menu-header">
        <text class="sub-menu-title">{{currentSubMenu === 'account' ? 'é€‰æ‹©è´¦æˆ·' : currentSubMenu === 'budget' ? 'é€‰æ‹©é¢„ç®—' : currentSubMenu === 'tag' ? 'é€‰æ‹©æ ‡ç­¾' : currentSubMenu === 'template' ? 'é€‰æ‹©æ¨¡æ¿' : 'é€‰æ‹©åˆ†ç±»'}}</text>
        <text class="sub-menu-close" bindtap="closeSubMenu">Ã—</text>
      </view>
      <view class="sub-menu-grid">
        <view class="sub-menu-item" 
              wx:for="{{subMenuItems}}" 
              wx:key="id" 
              bindtap="selectSubMenuItem" 
              data-item="{{item}}">
          <text class="sub-menu-icon">{{item.icon}}</text>
          <text class="sub-menu-name">{{item.name}}</text>
        </view>
      </view>
      <view wx:if="{{currentSubMenu === 'budget'}}" class="sub-menu-footer">
        <view class="budget-options">
          <view class="budget-option {{budgetScope === 'month' ? 'active' : ''}}" bindtap="selectBudgetScope" data-value="month">
            <text>è®¡å…¥å½“æœˆé¢„ç®—</text>
          </view>
          <view class="budget-option {{budgetScope === 'year' ? 'active' : ''}}" bindtap="selectBudgetScope" data-value="year">
            <text>åªè®¡å…¥å¹´é¢„ç®—</text>
          </view>
          <view class="budget-option {{budgetScope === 'none' ? 'active' : ''}}" bindtap="selectBudgetScope" data-value="none">
            <text>ä¸è®¡å…¥é¢„ç®—</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</view>
