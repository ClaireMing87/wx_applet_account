<view class="container">
  <!-- ç­›é€‰æ  -->
  <view class="filter-container">
    <!-- ç­›é€‰æŒ‰é’®è¡Œ -->
    <view class="filter-buttons">
      <view class="filter-btn" bindtap="showTimeFilter">
        <text class="filter-icon">ğŸ“…</text>
        <text class="filter-text">æ—¶é—´</text>
      </view>
      <view class="filter-btn" bindtap="showTypeFilter">
        <text class="filter-icon">ğŸ’°</text>
        <text class="filter-text">æ”¶æ”¯</text>
      </view>
      <view class="filter-btn" bindtap="showCategoryFilter">
        <text class="filter-icon">ğŸ·ï¸</text>
        <text class="filter-text">åˆ†ç±»</text>
      </view>
      <view class="filter-btn" bindtap="showAccountFilter">
        <text class="filter-icon">ğŸ’³</text>
        <text class="filter-text">è´¦æˆ·</text>
      </view>
    </view>
    
    <!-- ç­›é€‰æ ‡ç­¾è¡Œ -->
    <view class="filter-tags" wx:if="{{hasActiveFilters}}">
      <view class="filter-tag" wx:if="{{timeFilter !== 'all'}}" bindtap="clearTimeFilter">
        <text class="tag-text">æ—¶é—´: {{filterTimeText}}</text>
        <text class="tag-close">Ã—</text>
      </view>
      <view class="filter-tag" wx:if="{{typeFilter !== 'all'}}" bindtap="clearTypeFilter">
        <text class="tag-text">æ”¶æ”¯: {{filterTypeText}}</text>
        <text class="tag-close">Ã—</text>
      </view>
      <view class="filter-tag" wx:if="{{categoryFilter !== 'all'}}" bindtap="clearCategoryFilter">
        <text class="tag-text">åˆ†ç±»: {{filterCategoryText}}</text>
        <text class="tag-close">Ã—</text>
      </view>
      <view class="filter-tag" wx:if="{{accountFilter !== 'all'}}" bindtap="clearAccountFilter">
        <text class="tag-text">è´¦æˆ·: {{filterAccountText}}</text>
        <text class="tag-close">Ã—</text>
      </view>
      <view class="filter-clear-all" bindtap="clearFilters">
        <text class="clear-all-text">æ¸…é™¤å…¨éƒ¨</text>
      </view>
    </view>
  </view>

  <view class="card" wx:if="{{filteredRecords.length > 0}}">
    <view class="record-swipe" wx:for="{{filteredRecords}}" wx:key="id" data-id="{{item.id}}" bindtouchstart="onTouchStart" bindtouchmove="onTouchMove" bindtouchend="onTouchEnd">
      <view class="swipe-actions">
        <view class="btn edit" catchtap="onEdit" data-id="{{item.id}}" hover-class="button-hover">ç¼–è¾‘</view>
        <view class="btn delete" catchtap="onDelete" data-id="{{item.id}}" hover-class="button-hover">åˆ é™¤</view>
      </view>
      <view class="record-item" style="transform: translateX({{item.offsetX}}px);">
        <view class="row">
          <text class="icon">{{item.categoryIcon}}</text>
          <view class="info">
            <text class="title">{{item.categoryName}}</text>
            <text class="sub">{{item.accountDisplay}} Â· {{item.note || 'æ— å¤‡æ³¨'}}</text>
            <text class="time">{{item.createTime}}</text>
          </view>
          <text class="amount {{item.type === 'expense' ? 'expense' : 'income'}}">{{item.type === 'expense' ? '-' : '+'}}Â¥{{item.amount}}</text>
        </view>
      </view>
    </view>
  </view>
  <view class="empty" wx:else>
    <text>{{hasActiveFilters ? 'æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„è®°å½•' : 'æš‚æ— è®°å½•'}}</text>
  </view>

  <!-- æ—¶é—´ç­›é€‰å¼¹çª— -->
  <view class="filter-popup" wx:if="{{showTimeFilter}}" catchtap="hideTimeFilter">
    <view class="popup-content" catchtap="">
      <view class="popup-title">é€‰æ‹©æ—¶é—´èŒƒå›´</view>
      
      <!-- æ—¶é—´é€‰é¡¹ -->
      <view class="time-options">
        <view class="time-option {{timeFilter === 'all' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="all">å…¨éƒ¨æ—¶é—´</view>
        <view class="time-option {{timeFilter === 'today' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="today">ä»Šå¤©</view>
        <view class="time-option {{timeFilter === 'week' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="week">æœ¬å‘¨</view>
        <view class="time-option {{timeFilter === 'month' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="month">æœ¬æœˆ</view>
        <view class="time-option {{timeFilter === 'year' ? 'active' : ''}}" bindtap="selectTimeFilter" data-value="year">ä»Šå¹´</view>
        <view class="time-option {{timeFilter === 'custom' ? 'active' : ''}}" bindtap="showCustomTimePicker">è‡ªå®šä¹‰</view>
      </view>
    </view>
  </view>

  <!-- è‡ªå®šä¹‰æ—¶é—´é€‰æ‹©å¼¹çª— -->
  <view class="filter-popup" wx:if="{{showCustomTimePicker}}" catchtap="hideCustomTimePicker">
    <view class="popup-content custom-time-content" catchtap="">
      <view class="popup-title">é€‰æ‹©æ—¶é—´èŒƒå›´</view>
      
      <!-- å¼€å§‹æ—¶é—´é€‰æ‹© -->
      <view class="time-picker-section">
        <view class="time-picker-label">å¼€å§‹æ—¶é—´</view>
        <picker mode="date" value="{{customStartDate}}" bindchange="onStartDateChange">
          <view class="time-picker-value">
            <text class="picker-text">{{customStartDate || 'è¯·é€‰æ‹©å¼€å§‹æ—¥æœŸ'}}</text>
            <text class="picker-arrow">ğŸ“…</text>
          </view>
        </picker>
      </view>
      
      <!-- ç»“æŸæ—¶é—´é€‰æ‹© -->
      <view class="time-picker-section">
        <view class="time-picker-label">ç»“æŸæ—¶é—´</view>
        <picker mode="date" value="{{customEndDate}}" bindchange="onEndDateChange">
          <view class="time-picker-value">
            <text class="picker-text">{{customEndDate || 'è¯·é€‰æ‹©ç»“æŸæ—¥æœŸ'}}</text>
            <text class="picker-arrow">ğŸ“…</text>
          </view>
        </picker>
      </view>
      
      <!-- æ“ä½œæŒ‰é’® -->
      <view class="custom-time-actions">
        <view class="time-action-btn cancel-btn" bindtap="hideCustomTimePicker">å–æ¶ˆ</view>
        <view class="time-action-btn confirm-btn" bindtap="confirmCustomTime" wx:if="{{customStartDate && customEndDate}}">ç¡®å®š</view>
      </view>
    </view>
  </view>

  <!-- æ”¶æ”¯ç­›é€‰å¼¹çª— -->
  <view class="filter-popup" wx:if="{{showTypeFilter}}" catchtap="hideTypeFilter">
    <view class="popup-content" catchtap="">
      <view class="popup-title">é€‰æ‹©æ”¶æ”¯ç±»å‹</view>
      <view class="type-options">
        <view class="type-option {{typeFilter === 'all' ? 'active' : ''}}" bindtap="selectTypeFilter" data-value="all">å…¨éƒ¨</view>
        <view class="type-option {{typeFilter === 'expense' ? 'active' : ''}}" bindtap="selectTypeFilter" data-value="expense">æ”¯å‡º</view>
        <view class="type-option {{typeFilter === 'income' ? 'active' : ''}}" bindtap="selectTypeFilter" data-value="income">æ”¶å…¥</view>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»ç­›é€‰å¼¹çª— -->
  <view class="filter-popup" wx:if="{{showCategoryFilter}}" catchtap="hideCategoryFilter">
    <view class="popup-content" catchtap="">
      <view class="popup-title">é€‰æ‹©åˆ†ç±»</view>
      <view class="category-options" wx:if="{{typeFilter !== 'all'}}">
        <view class="category-option {{categoryFilter === 'all' ? 'active' : ''}}" bindtap="selectCategoryFilter" data-value="all">å…¨éƒ¨åˆ†ç±»</view>
        <view class="category-option" wx:for="{{filteredCategories}}" wx:key="id" 
              class="{{categoryFilter === item.id ? 'active' : ''}}" 
              bindtap="selectCategoryFilter" data-value="{{item.id}}">
          <text class="category-icon">{{item.icon}}</text>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
      <view class="category-options" wx:else>
        <view class="category-tip">
          <text>è¯·å…ˆé€‰æ‹©æ”¶æ”¯ç±»å‹</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è´¦æˆ·ç­›é€‰å¼¹çª— -->
  <view class="filter-popup" wx:if="{{showAccountFilter}}" catchtap="hideAccountFilter">
    <view class="popup-content" catchtap="">
      <view class="popup-title">é€‰æ‹©è´¦æˆ·</view>
      <view class="account-options">
        <view class="account-option {{accountFilter === 'all' ? 'active' : ''}}" bindtap="selectAccountFilter" data-value="all">å…¨éƒ¨è´¦æˆ·</view>
        <view class="account-option" wx:for="{{allAccounts}}" wx:key="id" 
              class="{{accountFilter === item.id ? 'active' : ''}}" 
              bindtap="selectAccountFilter" data-value="{{item.id}}">
          <text class="account-icon">{{item.icon}}</text>
          <text class="account-name">{{item.name}}</text>
        </view>
      </view>
    </view>
  </view>
</view>


